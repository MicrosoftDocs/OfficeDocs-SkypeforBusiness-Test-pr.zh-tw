---
title: Lync Server 2013：設定單一內部集區的 Web 發佈規則
TOCTitle: 設定單一內部集區的 Web 發佈規則
ms:assetid: 86ff4b2a-1ba9-46a2-a175-8b19e00a49dd
ms:mtpsurl: https://technet.microsoft.com/zh-tw/library/Gg429712(v=OCS.15)
ms:contentKeyID: 49291560
ms.date: 08/10/2015
mtps_version: v=OCS.15
ms.translationtype: HT
---

# 在 Lync Server 2013 中設定單一內部集區的 Web 發佈規則

 

_**上次修改主題的時間：** 2014-07-07_

Microsoft Forefront Threat Management Gateway 2010 和 Internet Information Server Application Request Routing (IIS ARR) 使用網頁發行規則將內部資源 (如會議 URL) 發行給網際網路中的使用者。

除了虛擬目錄的 Web 服務 URL 之外，您還必須針對簡易 URL、LyncDiscover URL 和 Office Web Apps Server 建立發行規則。對於每個簡易 URL，您必須在指向該簡易 URL 的反向 Proxy 上建立個別的規則。

如果您要部署行動性，並使用自動探索，您需要為外部自動探索服務 URL 建立發行規則。自動探索也需要發行規則，以用於 Director 集區和 前端集區的外部 Lync Server Web 服務 URL。如需有關為自動探索建立 Web 發行規則的詳細資訊，請參閱＜ [在 Lync Server 2013 中設定行動的反向 Proxy](lync-server-2013-configuring-the-reverse-proxy-for-mobility.md)＞。

請使用下列程序建立網頁發行規則。

> [!NOTE]  
> 這些程序假設您已安裝 Forefront Threat Management Gateway (TMG) 2010 標準版，或是已安裝和設定具有 Application request Routing (IIS ARR) 延伸模組功能的 Internet Information Server。您可以使用 TMG 或 IIS ARR。



## 若要在執行 TMG 2010 的電腦上建立 Web 伺服器發行規則

1.  按一下 \[開始\] ，並依序選取 \[程式集\] 和 \[Microsoft Forefront TMG\] ，然後按一下 \[Forefront TMG 管理\] 。

2.  在左邊的窗格，展開 \[伺服器名稱\] ，用滑鼠右鍵按一下 \[防火牆原則\] ，並選取 \[新增\] ，然後按一下 \[網站發行規則\] 。

3.  在 **\[歡迎使用新增網頁發行規則\]** 頁面上，輸入發行規則的顯示名稱 (如 LyncServerWebDownloadsRule)。

4.  在 **\[選取規則動作\]** 頁面上，按一下 **\[允許\]** 。

5.  在 **\[發行類型\]** 頁面上，選取 **\[發行單一網站或負載平衡器\]** 。

6.  在 **\[伺服器連線安全性\]** 頁面上，選取 **\[使用 SSL 連線到發佈的 Web 伺服器或伺服器陣列\]** 。

7.  在 **\[內部發行詳細資料\]** 頁面的 **\[內部網站名稱\]** 方塊中，輸入裝載會議內容和通訊錄內容之內部 Web 伺服陣列的完整網域名稱 (FQDN)。
    
    > [!NOTE]  
    > 如果您的內部伺服器是 Standard Edition Server，則此 FQDN 是 Standard Edition Server 的 FQDN。如果您的內部伺服器為前端集區，此 FQDN 即是使內部 Web 伺服器陣列負載平衡的硬體負載平衡器虛擬 IP (VIP)。TMG 伺服器必須可以將 FQDN 解析成內部 Web 伺服器的 IP 位址。如果 TMG 伺服器無法將 FQDN 解析為適當的 IP 位址，您可以選取 [使用要連線到發行伺服器的電腦名稱或 IP 位址] ，然後在 [電腦名稱] 或 [IP 位址] 方塊中輸入內部 Web 伺服器的 IP 位址。如果要這樣做，您必須確定 TMG 伺服器已經開啟連接埠 53，而且可以連結周邊網路中的 DNS 伺服器。您也可以使用本機主機檔案中的項目來提供名稱解析。
    


8.  在 **\[內部發行詳細資料\]** 頁面的 **\[路徑 (選用)\]** 方塊中，輸入 **/\*** 表示要發行的資料夾路徑。
    
    > [!NOTE]  
    > 在網站發行精靈中，您只能指定一個路徑。修改規則內容可以新增其他路徑。
    


9.  在 **\[公用名稱詳細資料\]** 頁面上，確認已為 **\[為右列接受要求\]** 選取 **\[這個網域名稱\]** ，並在 **\[公用名稱\]** 方塊中輸入外部 Web 服務 FQDN。

10. 在 **\[選取網頁接聽程式\]** 頁面上，按一下 **\[新增\]** 以開啟 \[新增網頁接聽程式定義精靈\]。

11. 在 **\[歡迎使用新網頁接聽程式精靈\]** 頁面的 **\[網頁接聽程式名稱\]** 方塊中，輸入網頁接聽程式的名稱 (如 LyncServerWebServers)。

12. 在 **\[用戶端連線安全性\]** 頁面上，選取 **\[需要與用戶端之間的 SSL 安全連線\]** 。

13. 在 **\[網頁接聽程式 IP 位址\]** 頁面上，選取 **\[外部\]** ，然後按一下 **\[選取 IP 位址\]** 。

14. 在 **\[外部接聽程式 IP 選取\]** 頁面上，選取所選網路中的 **\[Forefront TMG 的指定 IP 位址\]** 電腦，選取適當的 IP 位址，然後按一下 \[新增\] 。

15. 在 **\[接聽程式 SSL 憑證\]** 頁面上，選取 **\[為每一 IP 位址指派憑證\]** ，選取與外部 Web FQDN 相關聯的 IP 位址，然後按一下 **\[選取憑證\]** 。

16. 在 **\[選取憑證\]** 頁面上，選取符合步驟 9 指定之公用名稱的憑證，然後按一下 **\[選取\]** 。

17. 在 **\[驗證設定\]** 頁面上，選取 **\[沒有驗證\]** 。

18. 在 **\[單一登入設定\]** 頁面上，按 **\[下一步\]** 。

19. 在 **\[正在完成網頁接聽程式精靈\]** 頁面上，確認 **\[網頁接聽程式\]** 設定正確，然後按一下 \[完成\] 。

20. 在 \[驗證委派\] 頁面上選取 \[沒有委派，但用戶端可以直接驗證\] 。

21. 在 **\[使用者組\]** 頁面上，按 **\[下一步\]** 。

22. 在 **\[正在完成新網頁發行規則精靈\]** 頁面上，確認網頁發行規則設定正確，然後按一下 \[完成\] 。

23. 按一下詳細資料窗格中的 **\[套用\]** ，以儲存變更並更新設定。

## 若要在執行 IIS ARR 的電腦上建立 Web 伺服器發行規則

1.  將用於反向 Proxy 的憑證繫結到 HTTPS 通訊協定。按一下 **\[開始\]** ，選取 **\[所有程式\]** ，再選取 **\[系統管理工具\]** ，然後按一下 **\[Internet Information Services (IIS) 管理員\]** 。
    
    > [!NOTE]  
    > 其他有關部署和設定 IIS ARR 的說明、螢幕擷取畫面和指引，可以在 NextHop 文章 <a href="http://go.microsoft.com/fwlink/?linkid=293391">使用 IIS ARR 做為 Lync Server 2013 的反向 Proxy</a> (英文) 中找到。
    


2.  如果您尚未匯入要用於反向 Proxy 的憑證，請進行匯入。在 **\[Internet Information Services (IIS) 管理員\]** 中，按一下主控台左側的反向 Proxy 伺服器名稱。在主控台中央的 **\[IIS\]** 下方，找出 **\[伺服器憑證\]** ，在 **\[伺服器憑證\]** 上按一下滑鼠右鍵並選取 **\[開啟功能\]** 。

3.  在主控台右側，按一下 **\[匯入…\]** 。輸入憑證路徑和檔名並加上副檔名，或按一下 **\[…\]** 瀏覽憑證。選取憑證並按一下 **\[開啟\]** 。輸入用以保護私密金鑰的密碼 (如果您匯出憑證和私密金鑰時指派了密碼)。按一下 **\[確定\]** 。如果憑證匯入成功，憑證會顯示為主控台中央 **\[伺服器憑證\]** 中的項目。

4.  指派憑證供 HTTPS 使用。在主控台左側，選取 IIS 伺服器的 **\[預設的網站\]** 。在右側，按一下 **\[繫結…\]** 。在 **\[站台繫結\]** 對話方塊中，按一下 **\[新增…\]** 。在 **\[新增站台繫結\]** 對話方塊中的 **\[類型:\]** 下，選取 **\[https\]** 。選取 https 可以讓您選取要用於 https 的憑證。在 **\[SSL 憑證:\]** 下，選取您匯入供反向 Proxy 使用的憑證。按一下 **\[確定\]** 。接著，按一下 **\[關閉\]** 。憑證現在已繫結到安全通訊端層 (SSL) 和傳輸層安全性 (TLS) 的反向 Proxy。
    
    > [!IMPORTANT]  
    > 如果您在關閉 [繫結] 對話方塊時看到中繼憑證遺失的訊息，您需要找出並匯入公用 CA 根憑證授權及任何中繼 CA 憑證。請參考您要求憑證之來源公用 CA 的相關指示，依照指示要求與匯入憑證鏈結。如果您是從 Edge Server 匯出憑證，則可以匯出根 CA 憑證及任何與 Edge Server 關聯的中繼 CA 憑證。請將根 CA 憑證匯入電腦的 (請留意勿與使用者存放區混淆) 受信任的根憑證授權單位存放區，並將中繼憑證匯入電腦的中繼憑證授權單位存放區。
    


5.  在主控台左側 IIS 伺服器名稱下方，在 **\[伺服器陣列\]** 上按一下滑鼠右鍵，然後按一下 **\[建立伺服器陣列…\]** 。
    
    > [!NOTE]  
    > 如果您沒有看到 <strong>[伺服器陣列]</strong> 節點，代表需要安裝 Application Request Routing。如需詳細資訊，請參閱 <a href="lync-server-2013-setting-up-reverse-proxy-servers.md">設定 Lync Server 2013 的反向 Proxy 伺服器</a>。
    
    
    在 **\[建立伺服器陣列\]** 對話方塊的 **\[伺服器陣列名稱\]** 中，為第一個 URL 輸入名稱 (可以是便於識別的易記名稱)。按 **\[下一步\]** 。

6.  在 **\[新增伺服器\]** 對話方塊的 **\[伺服器位址\]** 中，輸入 前端伺服器 上外部 Web 服務的完整網域名稱 (FQDN)。於此處做為範例之用的名稱與反向 Proxy 規劃一節 [Lync Server 2013 中的憑證摘要 - 反向 Proxy](lync-server-2013-certificate-summary-reverse-proxy.md) 中所用的名稱相同。為與反向 Proxy 規劃內容相互呼應，我們輸入 FQDN `webext.contoso.com`。確認 **\[線上\]** 旁的核取方塊已選取。按一下 **\[新增\]** 將伺服器新增到此組態之網頁伺服器集區。
    
    > [!WARNING]
    > Lync Server 會使用硬體負載平衡器共用 Director 和 前端伺服器 處理 HTTP 和 HTTPS 流量。新增一部伺服器到 IIS ARR 伺服器陣列時，只需要提供單一 FQDN。該 FQDN 會是非共用伺服器組態中的 前端伺服器 或 Director，或是經設定用於伺服器集區之硬體負載平衡器的 FQDN。讓 HTTP 和 HTTPS 流量達到負載平衡的唯一支援方法是使用硬體負載平衡器。


7.  在 **\[新增伺服器\]** 對話方塊中，按一下 **\[進階設定…\]** 。如此會開啟對話方塊，讓您可以為設定之 FQDN 的要求定義應用程式要求路由。此作業的目的在重新定義當要求由 IIS ARR 處理時所使用的連接埠。
    
    依照預設，目的地 HTTP 連接埠必須定義為 8080。在目前的 **\[httpPort 80\]** 旁按一下，並將值設為 **8080** 。在目前的 **\[httpsPort 443\]** 旁按一下，並將值設為 **4443** 。將 **\[權數\]** 參數值保持為 100。如有需要，當您取得基準統計資料後，可以為特定規則重新定義權數。按一下 **\[完成\]** ，結束這部分的規則組態。

8.  可能會顯示 \[重寫規則\] 對話方塊，指出 IIS 管理員可以建立 URL 重寫規則，自動將所有傳入要求路由傳送到伺服器陣列。按一下 **\[是\]** 。您將會手動調整規則，但選取 \[是\] 可以設定初始組態。

9.  按一下您剛剛建立的伺服器陣列名稱。在 IIS 管理員 \[功能檢視\] 中的 **\[伺服器陣列\]** 下方，按兩下 **\[快取處理\]** 。取消選取 **\[啟用磁碟快取\]** 。按一下右側的 **\[套用\]** 。

10. 按一下伺服器陣列的名稱。在 IIS 管理員 \[功能檢視\] 中的 \[伺服器陣列\] 下方，按兩下 \[Proxy\]。在 \[Proxy 設定\] 頁面上，將 \[逾時 (秒)\] 值變更為適合您部署的值。按一下 \[套用\] 儲存變更。
    
    > [!IMPORTANT]  
    > 每次部署的 Proxy 逾時值數字會有所不同。您應該監視您的部署及修改值，讓用戶端有最佳的體驗。您可以設定低至 200 的值。如果您在環境中支援 Lync 行動用戶端，則應將值設為 960，以允許從逾時值為 900 的 Office 365 中推入通知逾時。當值太低時，您很可能需要增加逾時值以避免用戶端中斷連線，而如果透過 Proxy 進行的連線於用戶端中斷連線後很久仍未斷線與清除，您可能需要降低數字。唯一能夠精確判斷此值是否正確設定的方式，是監控您的環境並為環境中的常態訂定基準。
    


11. 按一下伺服器陣列名稱。在 IIS 管理員 \[功能檢視\] 中的 **\[伺服器陣列\]** 下方，按兩下 **\[路由規則\]** 。在 \[路由規則\] 對話方塊的 \[路由\] 下方，清除 \[啟用 SSL 卸載\] 旁的核取方塊。如果無法清除該核取方塊，請選取 **\[使用 URL Rewrite 檢查傳入要求\]** 核取方塊。按一下 **\[套用\]** 儲存變更。
    
    > [!CAUTION]
    > 不支援由反向 Proxy 進行 SSL 卸載。


12. 為每個必須通過反向 Proxy 的 URL 重複步驟 5-11。常見的清單如下：
    
      - 前端伺服器 外部 Web 服務：webext.contoso.com (已由初始逐步查核設定)
    
      - 適用於 Director 的 Director 外部 Web 服務：webdirext.contoso.com (如果已部署 Director，則為選用)
    
      - 會議 (Meet) 簡單 URL：meet.contoso.com
    
      - 撥入(Dial-in) 簡單 URL：dialin.contoso.com
    
      - Lync 自動探索 URL：lyncdiscover.contoso.com
    
      - Office Web Apps Server URL：officewebapps01.contoso.com
        
        > [!IMPORTANT]  
        > Office Web Apps Server 的 URL 會使用不同的 httpsPort 位址。在步驟 7 中，您會將 <strong>httpsPort</strong> 定義為 <strong>443</strong> ，並將 <strong>httpPort</strong> 定義為連接埠 <strong>80</strong> 。所有其他組態設定都是相同的。
        


13. 在主控台左側，按一下 IIS 伺服器名稱。在主控台中央，於 **IIS** 下找出 **\[URL Rewrite\]** 。按兩下 \[URL Rewrite\] 以開啟 URL Rewrite 規則組態。您應會看到您於先前步驟中為每個伺服器陣列建立的規則。如果沒有看到，請確認已於 IIS 管理員主控台中按下 **\[起始網頁\]** 節點正下方的 **\[IIS 伺服器\]** 名稱。

14. 在 **\[URL Rewrite\]** 對話方塊中，使用 webext.contoso.com 做為範例，顯示的規則全名會是 **ARR\_webext.contoso.com\_loadbalance\_SSL** 。
    
      - 按兩下規則以開啟 **\[編輯輸入規則\]** 對話方塊。
    
      - 按一下 **\[條件\]** 對話方塊中的 **\[新增...\]** 。
    
      - 在 **\[條件輸入:\]** 中的 **\[新增條件\]** 內，輸入 **{HTTP\_HOST}** (當您輸入時，會顯示對話方塊讓您選取條件)。在 **\[檢查輸入字串是否:\]** 下，選取 **\[符合模式\]** 。在 **\[模式輸入\]** 中，輸入 **\*** 。同時也應選取 **\[忽略大小寫\]** 。按一下 **\[確定\]** 。
    
      - 在 **\[編輯輸入規則\]** 對話方塊中向下捲動，找出 **\[動作\]** 對話方塊。 **\[動作類型:\]** 應設為 **\[路由傳送到伺服器陣列\]** ， **\[配置:\]** 應設為 **\[https://\]** ， **\[伺服器陣列:\]** 應設為套用此規則的 URL。就此範例而言，此項目應設為 **webext.contoso.com** 。 **\[路徑:\]** 設為 **\[/{R:0}\]**
    
      - 按一下 **\[套用\]** 儲存變更。按一下 **\[返回規則\]** 返回 URL Rewrite 規則。

15. 為每個定義的 SSL 重寫規則重複步驟 14 中定義的程序，每個伺服器陣列 URL 使用一個。
    
    > [!WARNING]
    > 依照預設，也會建立 HTTP 規則並會以類似 SSL 規則的命名加以代表。就目前的範例而言，HTTP 規則會命名為 <strong>ARR_webext.contoso.com_loadbalance</strong> 。不需要修改這些規則，可以安全加以忽略。


## 若要修改 TMG 2010 中網頁發行規則的內容

1.  按一下 \[開始\] ，指向 \[程式集\] ，並選取 \[Microsoft Forefront TMG\] ，然後按一下 \[Forefront TMG 管理\] 。

2.  在左邊的窗格中，展開 **\[伺服器名稱\]** ，然後按一下 **\[防火牆原則\]** 。

3.  在詳細資料窗格中，用滑鼠右鍵按一下在先前程序中建立的安全 Web 伺服器發行規則 (如 LyncServerExternalRule)，然後按一下 \[內容\] 。

4.  在 **\[內容\]** 頁面上按一下 **\[從\]** 索引標籤，並執行下列動作：
    
      - 在 **\[這個規則套用到來自下列來源的流量\]** 清單中，按一下 **\[任何地方\]** ，然後按一下 **\[移除\]** 。
    
      - 按一下 \[新增\] 。
    
      - 在 **\[新增網路實體\]** 中，展開 **\[網路\]** ，依序按一下 **\[外部\]** 、 **\[新增\]** 和 **\[關閉\]** 。

5.  在 **\[到\]** 索引標籤中，確認 **\[轉寄原始主機標頭而非實際標頭\]** 核取方塊已選取。

6.  在 **\[橋接\]** 索引標籤中，選取 **\[將要求重新導向 SSL 連接埠\]** 核取方塊，然後指定連接埠 **\[4443\]** 。

7.  在 **\[公用名稱\]** 索引標籤中新增簡易 URL (如 meet.contoso.com 和 dialin.contoso.com)。

8.  按一下 **\[套用\]** 儲存變更，然後按一下 \[確定\] 。

9.  按一下詳細資料窗格中的 **\[套用\]** ，以儲存變更並更新設定。

## 若要修改 IIS ARR 中網頁發行規則的內容

1.  按一下 **\[開始\]** ，選取 **\[所有程式\]** 、\[系統管理工具\] ，然後按一下 **\[Internet Information Services (IIS) 管理員\]** 。

2.  在主控台左側，按一下 IIS 伺服器名稱。

3.  在主控台中央，於 **IIS** 下找出 **\[URL Rewrite\]** 。按兩下 \[URL Rewrite\] 以開啟 URL Rewrite 規則組態。

4.  按兩下您要修改的規則。視需要修改 **\[比對 URL\]** 、 **\[條件\]** 、 **\[伺服器變數\]** 或 **\[動作\]** 。

5.  按一下 **\[套用\]** 以認可您的變更。按一下 **\[返回規則\]** 以修改其他規則，如果您已完成變更，可以關閉 **\[IIS 管理員\]** 主控台。

