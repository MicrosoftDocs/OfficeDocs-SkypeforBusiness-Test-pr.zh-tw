---
title: 在 Lync Server 2013 設定 XMPP 閘道
TOCTitle: 在 Lync Server 2013 設定 XMPP 閘道
ms:assetid: c70282e0-b502-47e2-a0be-a32eb1faf99d
ms:mtpsurl: https://technet.microsoft.com/zh-tw/library/JJ721881(v=OCS.15)
ms:contentKeyID: 49890304
ms.date: 08/24/2015
mtps_version: v=OCS.15
ms.translationtype: HT
---

# 在 Lync Server 2013 設定 XMPP 閘道

 

_**上次修改主題的時間：** 2013-10-28_

移轉 XMPP 閘道的最後幾個步驟，是設定 Lync Server 2013 Edge Server 的憑證、部署 Lync Server 2013 XMPP 閘道，以及更新 XMPP 閘道的 DNS 記錄。這些步驟應同時執行，以降低 XMPP 閘道的停機時間。在執行這些步驟前，必須先將所有使用者都移至 Microsoft Lync Server 2013 部署。

<table>
<thead>
<tr class="header">
<th><img src="images/Gg412908.important(OCS.15).gif" title="important" alt="important" />重要事項：</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>對位於 Survivable Branch Appliance 的使用者不支援 XMPP 同盟。這適用於查看目前狀態資訊與交換 IM 訊息。</td>
</tr>
</tbody>
</table>


## 在 Lync Server 2013 Edge Server 上設定 XMPP 閘道憑證

1.  在 Edge Server 的 \[部署精靈\] 中，按一下 \[步驟 3: 要求、安裝或指派憑證\] 旁邊的 \[再執行一次\] 。
    
    <table>
    <thead>
    <tr class="header">
    <th><img src="images/JJ205025.tip(OCS.15).gif" title="tip" alt="tip" />提示：</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td>如果您是第一次部署 Edge Server，則會顯示 [執行]，而非 [再執行一次]。</td>
    </tr>
    </tbody>
    </table>


2.  在 \[可用憑證工作\] 頁面上，按一下 \[建立新憑證要求\] 。

3.  在 \[憑證要求\] 頁面上，按一下 \[外部邊緣憑證\] 。

4.  在 \[延遲或立即要求\] 頁面上，選取 \[立即準備此要求，但稍後再傳送\] 核取方塊。

5.  在 \[憑證要求檔案\] 頁面上，輸入用來儲存此要求的檔案完整路徑和名稱 (例如，c:\\cert\_exernal\_edge.cer)。

6.  若要使用預設 WebServer 範本之外的其他範本，在 \[指定其他憑證範本\] 頁面上，選取 \[針對選取的憑證授權單位使用其他憑證範本\] 核取方塊。

7.  在 \[名稱和安全性設定\] 頁面上，執行下列動作：
    
    1.  在 \[易記名稱\] 中，輸入憑證的顯示名稱。
    
    2.  在 \[位元長度\] 中，指定位元長度 (預設值通常是 2048)。
    
    3.  確認已選取 \[將憑證私密金鑰標示為可匯出\] 核取方塊。

8.  在 \[組織資訊\] 頁面上，輸入組織的名稱和組織單位 (例如部門)。

9.  在 \[地理資訊\] 頁面上，指定位置資訊。

10. 在 \[主體名稱/主體別名\] 頁面上，會顯示精靈將自動填入的資訊。如果您還需要其他主體別名，請在後續兩個步驟中指定。

11. 在 \[主體別名 (SAN) 上的 SIP 網域設定\] 頁面上，選取網域核取方塊，以將 sip.\<sipdomain\> 項目新增至主體別名清單中。

12. 在 \[設定其他主體別名\] 頁面上，指定任何需要的其他主體別名。
    
    <table>
    <thead>
    <tr class="header">
    <th><img src="images/JJ205025.tip(OCS.15).gif" title="tip" alt="tip" />提示：</th>
    </tr>
    </thead>
    <tbody>
    <tr class="odd">
    <td>如果有安裝 XMPP Proxy，預設會在 SAN 項目中填入網域名稱 (如 contoso.com)。如果您需要其他項目，請在此步驟中新增。</td>
    </tr>
    </tbody>
    </table>


13. 在 \[要求摘要\] 頁面上，檢閱要用來產生要求的憑證資訊。

14. 命令執行完成後，您可以按一下 \[檢視記錄檔\] ，或按 \[下一步\] 繼續。

15. 在 \[憑證要求檔案\] 頁面上，可以按一下 \[檢視\] 檢視產生的憑證簽署要求 (CSR) 檔，或按一下 \[完成\] 結束憑證精靈。

16. 複製要求檔案並送出到您的公用憑證授權單位。

17. 在收到、匯入並指派公用憑證後，您必須停止再重新啟動 Edge Server 服務。若要執行此動作，請在 Lync Server 管理主控台輸入下列命令：
    
    ```
    Stop-CsWindowsService
    ```    
    ```
    Start-CsWindowsService
    ```

## 設定新的 Lync Server 2013 XMPP 閘道

1.  開啟 Lync Server 控制台。

2.  在左導覽列中，依序按一下 \[同盟和外部存取\] 和 \[XMPP 同盟協力廠商\] 。

3.  若要建立新組態，請按一下 \[新增\] 。

4.  定義下列設定：

5.  **主要網域** (必要)   主要網域是 XMPP 協力廠商的基底網域。例如，您可以輸入 **fabrikam.com** 做為 XMPP 協力廠商網域名稱。此為必要項目。

6.  **描述**    描述是做為此特定組態的附註或其他識別資訊。此為選用項目。

7.  **其他網域**    其他網域是指屬於 XMPP 協力廠商網域的一部分，且應納入允許的 XMPP 通訊中的網域。例如，如果主要網域是 **fabrikam.com**，則您可以列出 fabrikam.com 底下要透過 XMPP 進行通訊的所有其他網域。

8.  **協力廠商類型**    \[協力廠商類型\] 是必要設定。您必須選擇下列其中一項來描述及強制執行可以新增哪些連絡人。您可以選取的選項有：
    
      - **同盟**     **同盟**的協力廠商類型代表 Lync Server 部署與 XMPP 協力廠商之間有高度信任關係。建議對與同一家企業內或是與良好商業合作關係之企業內的 XMPP 伺服器同盟使用此協力廠商類型。同盟協力廠商中的 XMPP 連絡人可以：
        
        1.  新增 Lync 連絡人並檢視其目前狀態，而無需獲得 Lync 使用者的明確授權。
        
        2.  傳送立即訊息給 Lync 連絡人，無論該 Lync 使用者是否已將其新增至連絡人清單中。
        
        3.  查看 Lync 使用者的狀態附註。
    
      - **已確認的公用**     **已確認的公用**協力廠商是被信任可確實驗證其使用者身分的公用 XMPP 提供者。已確認的公用網路中的 XMPP 連絡人可以新增 Lync 連絡人、檢視其目前狀態以及傳送立即訊息給他們，而無需獲得 Lync 使用者的明確授權。已確認的公用網路中的 XMPP 連絡人永遠看不到 Lync 使用者的狀態附註。不建議使用此設定。
    
      - **未確認的公用**     **未確認的公用**協力廠商是不被信任可確實驗證其使用者身分的公用 XMPP 提供者。未確認的公用網路中的 XMPP 使用者必須要等 Lync 使用者將其新增至連絡人清單來加以明確授權後，才能與 Lync 使用者通訊。未確認的公用網路中的 XMPP 使用者不能看到 Lync 使用者的狀態附註。建議使用此設定對任何與公用 XMPP 提供者 (如 Google Talk) 進行同盟。

9.  **連線類型：**定義各種規則和回撥設定。
    
      - **TLS 交涉**    定義 TLS 交涉規則。XMPP 服務可以將 TLS 視為必要或選用，或者由您將 TLS 定義為不支援。選擇 \[選擇性\] 會將此需求留給 XMPP 服務進行必須交涉的決定。若要檢視所有可用設定以及 SASL、TLS 與回撥交涉的詳細資訊，包括無效及已知的錯誤組態，請參閱 [Lync Server 2013 中 XMPP 同盟夥伴的交涉設定](lync-server-2013-negotiation-settings-for-xmpp-federated-partners.md)。
        
          -   
            **需要**    XMPP 服務需要 TLS 交涉。
        
          -   
            **選擇性**    XMPP 服務指出必須交涉 TLS。
        
          -   
            **不支援**    XMPP 服務不支援 TLS。
    
      - **SASL 交涉**    定義 SASL 交涉規則。XMPP 服務可以將 SASL 視為必要或選用，或者由您將 SASL 定義為不支援。選擇 \[選擇性\] 會將此需求留給協力廠商 XMPP 服務進行必須交涉的決定。
        
          -   
            **必要**    XMPP 服務需要 SASL 交涉。
        
          -   
            **選擇性**    XMPP 服務指出必須交涉 SASL。
        
          -   
            **不支援**    XMPP 服務不支援 SASL。
    
      - **支援伺服器回撥交涉** 支援伺服器回撥交涉程序會使用網域名稱系統 (DNS) 和系統授權的伺服器，確認要求是否來自有效的 XMPP 協力廠商。其中過程是，來源伺服器會建立內含產生之回撥金鑰的特種訊息，並在 DNS 中查閱接收伺服器。來源伺服器以 XML 資料流傳送金鑰給產生的 DNS 查閱 (假定就是接收伺服器)。透過 XML 資料流收到金鑰後，接收伺服器不會回應發出來源伺服器，而是將金鑰傳送給已知的系統授權伺服器。系統授權伺服器接著確認該金鑰是否有效。如果無效，則接收伺服器不會回應來源伺服器。如果金鑰有效，則接收伺服器會通知來源伺服器該身分和金鑰有效，可以開始交談。
        
        **回撥交涉**有兩種有效狀態：
        
          -   
            **True**    XMPP 伺服器被設定為萬一從來源伺服器收到要求，則使用回撥交涉。
        
          -   
            **False**    XMPP 伺服器不被設定為使用回撥交涉；萬一從來源伺服器收到要求，將會忽略該要求。

10. 按一下 \[認可\] 將變更儲存至網站或使用者原則。

## 更新 Lync Server 2013 XMPP 閘道的 DNS 記錄

1.  若要設定 XMPP 同盟的 DNS，請新增下列 SRV 記錄至外部 DNS:\_xmpp-server.\_tcp.\<網域名稱\>。SRV 記錄會解析為 Edge Server 的 Access Edge FQDN，使用連接埠值 5269。

